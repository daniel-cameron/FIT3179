{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 400,
  "title": "Public Transport Trends and the Effect of COVID: Filter by Mode",

  "data": {
    "url": "https://raw.githubusercontent.com/daniel-cameron/FIT3179/refs/heads/W10/DV2/transport_long.csv",
    "format": {"parse": {"Date": "date:%d/%m/%Y"}}
  },

  "transform": [
    {
      "filter": "TransportMode_selection == null || datum.Mode == TransportMode_selection"
    },
    {"calculate": "year(datum.Date)", "as": "Year"}, 
    {"calculate": "timeFormat(datum.Date, '%B')", "as": "Month name"}
  ],

  "params": [
    {
      "name": "TransportMode_selection",
      "bind": {
        "input": "select",
        "options": [
          null,
          "Metropolitan train",
          "Metropolitan tram",
          "Metropolitan bus",
          "Regional train",
          "Regional coach",
          "Regional bus"
        ],
        "labels": [
          "Show All",
          "Metropolitan train",
          "Metropolitan tram",
          "Metropolitan bus",
          "Regional train",
          "Regional coach",
          "Regional bus"
        ],
        "name": "Select Transport Mode: "
      }
    }
  ],

  "layer": [
    {
      "mark": {"type": "line", "point": true},
      "encoding": {
        "x": {
          "field": "Date",
          "type": "temporal",
          "title": "Month",
          "timeUnit": "yearmonth"
        },
        "y": {
          "field": "Value",
          "type": "quantitative",
          "title": "Patronage (Number of Trips)",
          "axis": {"format": "~s"}
        },
        "color": {
          "field": "Mode",
          "type": "nominal",
          "title": "Transport Mode",
          "scale": {"scheme": "tableau10"}
        },
        "tooltip": [
          {"field": "Month name", "type": "nominal"},
          {"field": "Year", "type": "ordinal"},
          {"field": "Mode", "type": "nominal"},
          {"field": "Value", "type": "quantitative", "format": ","}
        ]
      }
    },

    {
      "data": {
        "values": [
          {"Date": "2020-03-01T00:00:00"}
        ]
      },
      "mark": {"type": "rule", "color": "red", "strokeWidth": 2, "strokeDash": [4, 4]},
      "encoding": {
        "x": {"field": "Date", "type": "temporal", "timeUnit": "yearmonth"}
      }
    },

    {
      "data": {
        "values": [
          {"Date": "2020-03-01T00:00:00", "label": "March 2020 - the first COVID-19 lockdown", "y": 30000000}
        ]
      },
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "bottom",
        "dx": 5,
        "dy": 20,
        "color": "red",
        "fontWeight": "bold"
      },
      "encoding": {
        "x": {"field": "Date", "type": "temporal", "timeUnit": "yearmonth"},
        "y": {"field": "y", "type": "quantitative"},
        "text": {"field": "label", "type": "nominal"}
      }
    }
  ]
}
